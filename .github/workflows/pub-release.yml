name: Pub Release

on:
    push:
        tags: ["v*"]
    workflow_dispatch:
        inputs:
            release_ref:
                description: "Git ref (branch, tag, or SHA) to build"
                required: false
                default: "main"
                type: string
            publish_release:
                description: "Publish a GitHub release (false = verification build only)"
                required: false
                default: false
                type: boolean
            release_tag:
                description: "Existing release tag (required when publish_release=true), e.g. v0.1.1"
                required: false
                default: ""
                type: string
            draft:
                description: "Create release as draft (manual publish only)"
                required: false
                default: true
                type: boolean
    schedule:
        # Weekly release-readiness verification on default branch (no publish)
        - cron: "17 8 * * 1"

concurrency:
    group: release-${{ github.ref || github.run_id }}
    cancel-in-progress: false

permissions:
    contents: write
    packages: read
    id-token: write # Required for cosign keyless signing via OIDC

env:
    GIT_CONFIG_COUNT: "1"
    GIT_CONFIG_KEY_0: core.hooksPath
    GIT_CONFIG_VALUE_0: /dev/null
    CARGO_TERM_COLOR: always

jobs:
    prepare:
        name: Prepare Release Context
        runs-on: [self-hosted, aws-india]
        outputs:
            release_ref: ${{ steps.vars.outputs.release_ref }}
            release_tag: ${{ steps.vars.outputs.release_tag }}
            publish_release: ${{ steps.vars.outputs.publish_release }}
            draft_release: ${{ steps.vars.outputs.draft_release }}
        steps:
            - name: Resolve release inputs
              id: vars
              shell: bash
              run: |
                  set -euo pipefail

                  event_name="${GITHUB_EVENT_NAME}"
                  publish_release="false"
                  draft_release="false"

                  if [[ "$event_name" == "push" ]]; then
                    release_ref="${GITHUB_REF_NAME}"
                    release_tag="${GITHUB_REF_NAME}"
                    publish_release="true"
                  elif [[ "$event_name" == "workflow_dispatch" ]]; then
                    release_ref="${{ inputs.release_ref }}"
                    publish_release="${{ inputs.publish_release }}"
                    draft_release="${{ inputs.draft }}"

                    if [[ "$publish_release" == "true" ]]; then
                      release_tag="${{ inputs.release_tag }}"
                      if [[ -z "$release_tag" ]]; then
                        echo "::error::release_tag is required when publish_release=true"
                        exit 1
                      fi
                      release_ref="$release_tag"
                    else
                      release_tag="verify-${GITHUB_SHA::12}"
                    fi
                  else
                    # schedule
                    release_ref="main"
                    release_tag="verify-${GITHUB_SHA::12}"
                  fi

                  {
                    echo "release_ref=${release_ref}"
                    echo "release_tag=${release_tag}"
                    echo "publish_release=${publish_release}"
                    echo "draft_release=${draft_release}"
                  } >> "$GITHUB_OUTPUT"

                  {
                    echo "### Release Context"
                    echo "- event: ${event_name}"
                    echo "- release_ref: ${release_ref}"
                    echo "- release_tag: ${release_tag}"
                    echo "- publish_release: ${publish_release}"
                    echo "- draft_release: ${draft_release}"
                  } >> "$GITHUB_STEP_SUMMARY"

            - name: Checkout
              uses: actions/checkout@34e114876b0b11c390a56381ad16ebd13914f8d5 # v4

            - name: Validate release trigger and authorization guard
              shell: bash
              run: |
                  set -euo pipefail
                  mkdir -p artifacts
                  python3 scripts/ci/release_trigger_guard.py \
                    --repo-root . \
                    --repository "${GITHUB_REPOSITORY}" \
                    --event-name "${GITHUB_EVENT_NAME}" \
                    --actor "${GITHUB_ACTOR}" \
                    --release-ref "${{ steps.vars.outputs.release_ref }}" \
                    --release-tag "${{ steps.vars.outputs.release_tag }}" \
                    --publish-release "${{ steps.vars.outputs.publish_release }}" \
                    --authorized-actors "${{ vars.RELEASE_AUTHORIZED_ACTORS || 'willsarg,theonlyhennygod,chumyin' }}" \
                    --authorized-tagger-emails "${{ vars.RELEASE_AUTHORIZED_TAGGER_EMAILS || '' }}" \
                    --require-annotated-tag true \
                    --output-json artifacts/release-trigger-guard.json \
                    --output-md artifacts/release-trigger-guard.md \
                    --fail-on-violation

            - name: Emit release trigger audit event
              if: always()
              shell: bash
              run: |
                  set -euo pipefail
                  python3 scripts/ci/emit_audit_event.py \
                    --event-type release_trigger_guard \
                    --input-json artifacts/release-trigger-guard.json \
                    --output-json artifacts/audit-event-release-trigger-guard.json \
                    --artifact-name release-trigger-guard \
                    --retention-days 30

            - name: Publish release trigger guard summary
              if: always()
              shell: bash
              run: |
                  set -euo pipefail
                  cat artifacts/release-trigger-guard.md >> "$GITHUB_STEP_SUMMARY"

            - name: Upload release trigger guard artifacts
              if: always()
              uses: actions/upload-artifact@b7c566a772e6b6bfb58ed0dc250532a479d7789f # v6.0.0
              with:
                  name: release-trigger-guard
                  path: |
                      artifacts/release-trigger-guard.json
                      artifacts/release-trigger-guard.md
                      artifacts/audit-event-release-trigger-guard.json
                  if-no-files-found: error
                  retention-days: 30

    build-release:
        name: Build ${{ matrix.target }}
        needs: [prepare]
        runs-on: ${{ matrix.os }}
        timeout-minutes: 40
        strategy:
            fail-fast: false
            matrix:
                include:
                    # Keep GNU Linux release artifacts on Ubuntu 22.04 to preserve
                    # a broadly compatible GLIBC baseline for user distributions.
                    - os: ubuntu-22.04
                      target: x86_64-unknown-linux-gnu
                      artifact: zeroclaw
                      archive_ext: tar.gz
                      cross_compiler: ""
                      linker_env: ""
                      linker: ""
                    - os: self-hosted
                      target: x86_64-unknown-linux-musl
                      artifact: zeroclaw
                      archive_ext: tar.gz
                      cross_compiler: ""
                      linker_env: ""
                      linker: ""
                      use_cross: true
                    - os: ubuntu-22.04
                      target: aarch64-unknown-linux-gnu
                      artifact: zeroclaw
                      archive_ext: tar.gz
                      cross_compiler: gcc-aarch64-linux-gnu
                      linker_env: CARGO_TARGET_AARCH64_UNKNOWN_LINUX_GNU_LINKER
                      linker: aarch64-linux-gnu-gcc
                    - os: self-hosted
                      target: aarch64-unknown-linux-musl
                      artifact: zeroclaw
                      archive_ext: tar.gz
                      cross_compiler: ""
                      linker_env: ""
                      linker: ""
                      use_cross: true
                    - os: ubuntu-22.04
                      target: armv7-unknown-linux-gnueabihf
                      artifact: zeroclaw
                      archive_ext: tar.gz
                      cross_compiler: gcc-arm-linux-gnueabihf
                      linker_env: CARGO_TARGET_ARMV7_UNKNOWN_LINUX_GNUEABIHF_LINKER
                      linker: arm-linux-gnueabihf-gcc
                    - os: self-hosted
                      target: armv7-linux-androideabi
                      artifact: zeroclaw
                      archive_ext: tar.gz
                      cross_compiler: ""
                      linker_env: ""
                      linker: ""
                      android_ndk: true
                      android_api: 21
                    - os: self-hosted
                      target: aarch64-linux-android
                      artifact: zeroclaw
                      archive_ext: tar.gz
                      cross_compiler: ""
                      linker_env: ""
                      linker: ""
                      android_ndk: true
                      android_api: 21
                    - os: self-hosted
                      target: x86_64-unknown-freebsd
                      artifact: zeroclaw
                      archive_ext: tar.gz
                      cross_compiler: ""
                      linker_env: ""
                      linker: ""
                      use_cross: true
                    - os: macos-15-intel
                      target: x86_64-apple-darwin
                      artifact: zeroclaw
                      archive_ext: tar.gz
                      cross_compiler: ""
                      linker_env: ""
                      linker: ""
                    - os: macos-14
                      target: aarch64-apple-darwin
                      artifact: zeroclaw
                      archive_ext: tar.gz
                      cross_compiler: ""
                      linker_env: ""
                      linker: ""
                    - os: windows-latest
                      target: x86_64-pc-windows-msvc
                      artifact: zeroclaw.exe
                      archive_ext: zip
                      cross_compiler: ""
                      linker_env: ""
                      linker: ""

        steps:
            - uses: actions/checkout@34e114876b0b11c390a56381ad16ebd13914f8d5 # v4
              with:
                  ref: ${{ needs.prepare.outputs.release_ref }}

            - uses: dtolnay/rust-toolchain@631a55b12751854ce901bb631d5902ceb48146f7 # stable
              with:
                  toolchain: 1.92.0
                  targets: ${{ matrix.target }}

            - uses: useblacksmith/rust-cache@f53e7f127245d2a269b3d90879ccf259876842d5 # v3
              if: runner.os != 'Windows'

            - name: Install cross for cross-built targets
              if: matrix.use_cross
              run: |
                  cargo install cross --git https://github.com/cross-rs/cross

            - name: Install cross-compilation toolchain (Linux)
              if: runner.os == 'Linux' && matrix.cross_compiler != ''
              run: |
                  sudo apt-get update -qq
                  sudo apt-get install -y "${{ matrix.cross_compiler }}"

            - name: Setup Android NDK
              if: matrix.android_ndk
              shell: bash
              run: |
                  set -euo pipefail
                  NDK_VERSION="r26d"
                  NDK_ZIP="android-ndk-${NDK_VERSION}-linux.zip"
                  NDK_URL="https://dl.google.com/android/repository/${NDK_ZIP}"
                  NDK_ROOT="${RUNNER_TEMP}/android-ndk"
                  NDK_HOME="${NDK_ROOT}/android-ndk-${NDK_VERSION}"

                  sudo apt-get update -qq
                  sudo apt-get install -y unzip

                  mkdir -p "${NDK_ROOT}"
                  curl -fsSL "${NDK_URL}" -o "${RUNNER_TEMP}/${NDK_ZIP}"
                  unzip -q "${RUNNER_TEMP}/${NDK_ZIP}" -d "${NDK_ROOT}"

                  echo "ANDROID_NDK_HOME=${NDK_HOME}" >> "$GITHUB_ENV"
                  echo "${NDK_HOME}/toolchains/llvm/prebuilt/linux-x86_64/bin" >> "$GITHUB_PATH"

            - name: Configure Android toolchain
              if: matrix.android_ndk
              shell: bash
              run: |
                  echo "Setting up Android NDK toolchain for ${{ matrix.target }}"
                  NDK_HOME="${ANDROID_NDK_HOME:-}"
                  if [[ -z "$NDK_HOME" ]]; then
                    echo "::error::ANDROID_NDK_HOME was not configured."
                    exit 1
                  fi
                  TOOLCHAIN="$NDK_HOME/toolchains/llvm/prebuilt/linux-x86_64/bin"
                  
                  # Add to path for linker resolution
                  echo "$TOOLCHAIN" >> "$GITHUB_PATH"
                  
                  # Set linker environment variables
                  if [[ "${{ matrix.target }}" == "armv7-linux-androideabi" ]]; then
                    ARMV7_CC="${TOOLCHAIN}/armv7a-linux-androideabi${{ matrix.android_api }}-clang"
                    ARMV7_CXX="${TOOLCHAIN}/armv7a-linux-androideabi${{ matrix.android_api }}-clang++"

                    # Some crates still probe legacy compiler names (arm-linux-androideabi-clang).
                    ln -sf "$ARMV7_CC" "${TOOLCHAIN}/arm-linux-androideabi-clang"
                    ln -sf "$ARMV7_CXX" "${TOOLCHAIN}/arm-linux-androideabi-clang++"

                    {
                      echo "CARGO_TARGET_ARMV7_LINUX_ANDROIDEABI_LINKER=${ARMV7_CC}"
                      echo "CC_armv7_linux_androideabi=${ARMV7_CC}"
                      echo "CXX_armv7_linux_androideabi=${ARMV7_CXX}"
                      echo "AR_armv7_linux_androideabi=${TOOLCHAIN}/llvm-ar"
                    } >> "$GITHUB_ENV"
                  elif [[ "${{ matrix.target }}" == "aarch64-linux-android" ]]; then
                    AARCH64_CC="${TOOLCHAIN}/aarch64-linux-android${{ matrix.android_api }}-clang"
                    AARCH64_CXX="${TOOLCHAIN}/aarch64-linux-android${{ matrix.android_api }}-clang++"

                    {
                      echo "CARGO_TARGET_AARCH64_LINUX_ANDROID_LINKER=${AARCH64_CC}"
                      echo "CC_aarch64_linux_android=${AARCH64_CC}"
                      echo "CXX_aarch64_linux_android=${AARCH64_CXX}"
                      echo "AR_aarch64_linux_android=${TOOLCHAIN}/llvm-ar"
                    } >> "$GITHUB_ENV"
                  fi

            - name: Build release
              shell: bash
              env:
                  LINKER_ENV: ${{ matrix.linker_env }}
                  LINKER: ${{ matrix.linker }}
                  USE_CROSS: ${{ matrix.use_cross }}
              run: |
                  if [ -n "$LINKER_ENV" ] && [ -n "$LINKER" ]; then
                    echo "Using linker override: $LINKER_ENV=$LINKER"
                    export "$LINKER_ENV=$LINKER"
                  fi
                  if [ "$USE_CROSS" = "true" ]; then
                    echo "Using cross for MUSL target"
                    cross build --profile release-fast --locked --target ${{ matrix.target }}
                  else
                    cargo build --profile release-fast --locked --target ${{ matrix.target }}
                  fi

            - name: Check binary size (Unix)
              if: runner.os != 'Windows'
              run: bash scripts/ci/check_binary_size.sh "target/${{ matrix.target }}/release-fast/${{ matrix.artifact }}" "${{ matrix.target }}"

            - name: Package (Unix)
              if: runner.os != 'Windows'
              run: |
                  cd target/${{ matrix.target }}/release-fast
                  tar czf ../../../zeroclaw-${{ matrix.target }}.${{ matrix.archive_ext }} ${{ matrix.artifact }}

            - name: Package (Windows)
              if: runner.os == 'Windows'
              run: |
                  cd target/${{ matrix.target }}/release-fast
                  7z a ../../../zeroclaw-${{ matrix.target }}.${{ matrix.archive_ext }} ${{ matrix.artifact }}

            - name: Upload artifact
              uses: actions/upload-artifact@b7c566a772e6b6bfb58ed0dc250532a479d7789f # v6
              with:
                  name: zeroclaw-${{ matrix.target }}
                  path: zeroclaw-${{ matrix.target }}.${{ matrix.archive_ext }}
                  retention-days: 7

    verify-artifacts:
        name: Verify Artifact Set
        needs: [prepare, build-release]
        runs-on: [self-hosted, aws-india]
        steps:
            - uses: actions/checkout@34e114876b0b11c390a56381ad16ebd13914f8d5 # v4
              with:
                  ref: ${{ needs.prepare.outputs.release_ref }}

            - name: Download all artifacts
              uses: actions/download-artifact@37930b1c2abaa49bbe596cd826c3c89aef350131 # v7.0.0
              with:
                  path: artifacts

            - name: Validate release archive contract (verify stage)
              shell: bash
              run: |
                  set -euo pipefail
                  python3 scripts/ci/release_artifact_guard.py \
                    --artifacts-dir artifacts \
                    --contract-file .github/release/release-artifact-contract.json \
                    --output-json artifacts/release-artifact-guard.verify.json \
                    --output-md artifacts/release-artifact-guard.verify.md \
                    --allow-extra-archives \
                    --skip-manifest-files \
                    --skip-sbom-files \
                    --skip-notice-files \
                    --fail-on-violation

            - name: Emit verify-stage artifact guard audit event
              if: always()
              shell: bash
              run: |
                  set -euo pipefail
                  python3 scripts/ci/emit_audit_event.py \
                    --event-type release_artifact_guard_verify \
                    --input-json artifacts/release-artifact-guard.verify.json \
                    --output-json artifacts/audit-event-release-artifact-guard-verify.json \
                    --artifact-name release-artifact-guard-verify \
                    --retention-days 21

            - name: Publish verify-stage artifact guard summary
              if: always()
              shell: bash
              run: |
                  set -euo pipefail
                  cat artifacts/release-artifact-guard.verify.md >> "$GITHUB_STEP_SUMMARY"

            - name: Upload verify-stage artifact guard reports
              if: always()
              uses: actions/upload-artifact@b7c566a772e6b6bfb58ed0dc250532a479d7789f # v6.0.0
              with:
                  name: release-artifact-guard-verify
                  path: |
                      artifacts/release-artifact-guard.verify.json
                      artifacts/release-artifact-guard.verify.md
                      artifacts/audit-event-release-artifact-guard-verify.json
                  if-no-files-found: error
                  retention-days: 21

    publish:
        name: Publish Release
        if: needs.prepare.outputs.publish_release == 'true'
        needs: [prepare, verify-artifacts]
        runs-on: [self-hosted, aws-india]
        timeout-minutes: 45
        steps:
            - uses: actions/checkout@34e114876b0b11c390a56381ad16ebd13914f8d5 # v4
              with:
                  ref: ${{ needs.prepare.outputs.release_ref }}

            - name: Download all artifacts
              uses: actions/download-artifact@37930b1c2abaa49bbe596cd826c3c89aef350131 # v7.0.0
              with:
                  path: artifacts

            - name: Install syft
              shell: bash
              run: |
                  set -euo pipefail
                  mkdir -p "${RUNNER_TEMP}/bin"
                  ./scripts/ci/install_syft.sh "${RUNNER_TEMP}/bin"
                  echo "${RUNNER_TEMP}/bin" >> "$GITHUB_PATH"

            - name: Generate SBOM (CycloneDX)
              run: |
                  syft dir:. --source-name zeroclaw -o cyclonedx-json=artifacts/zeroclaw.cdx.json -o spdx-json=artifacts/zeroclaw.spdx.json
                  {
                    echo "### SBOM Generated"
                    echo "- CycloneDX: zeroclaw.cdx.json"
                    echo "- SPDX: zeroclaw.spdx.json"
                  } >> "$GITHUB_STEP_SUMMARY"

            - name: Attach license and notice files
              run: |
                  cp LICENSE-APACHE artifacts/LICENSE-APACHE
                  cp LICENSE-MIT artifacts/LICENSE-MIT
                  cp NOTICE artifacts/NOTICE

            - name: Generate release manifest + checksums
              shell: bash
              env:
                  RELEASE_TAG: ${{ needs.prepare.outputs.release_tag }}
              run: |
                  set -euo pipefail
                  python3 scripts/ci/release_manifest.py \
                    --artifacts-dir artifacts \
                    --release-tag "${RELEASE_TAG}" \
                    --output-json artifacts/release-manifest.json \
                    --output-md artifacts/release-manifest.md \
                    --checksums-path artifacts/SHA256SUMS \
                    --fail-empty

            - name: Generate SHA256SUMS provenance statement
              shell: bash
              env:
                  RELEASE_TAG: ${{ needs.prepare.outputs.release_tag }}
              run: |
                  set -euo pipefail
                  python3 scripts/ci/generate_provenance.py \
                    --artifact artifacts/SHA256SUMS \
                    --subject-name "zeroclaw-${RELEASE_TAG}-sha256sums" \
                    --output artifacts/zeroclaw.sha256sums.intoto.json

            - name: Emit SHA256SUMS provenance audit event
              shell: bash
              run: |
                  set -euo pipefail
                  python3 scripts/ci/emit_audit_event.py \
                    --event-type release_sha256sums_provenance \
                    --input-json artifacts/zeroclaw.sha256sums.intoto.json \
                    --output-json artifacts/audit-event-release-sha256sums-provenance.json \
                    --artifact-name release-sha256sums-provenance \
                    --retention-days 30

            - name: Validate release artifact contract (publish stage)
              shell: bash
              run: |
                  set -euo pipefail
                  python3 scripts/ci/release_artifact_guard.py \
                    --artifacts-dir artifacts \
                    --contract-file .github/release/release-artifact-contract.json \
                    --output-json artifacts/release-artifact-guard.publish.json \
                    --output-md artifacts/release-artifact-guard.publish.md \
                    --allow-extra-archives \
                    --allow-extra-manifest-files \
                    --allow-extra-sbom-files \
                    --allow-extra-notice-files \
                    --fail-on-violation

            - name: Emit publish-stage artifact guard audit event
              if: always()
              shell: bash
              run: |
                  set -euo pipefail
                  python3 scripts/ci/emit_audit_event.py \
                    --event-type release_artifact_guard_publish \
                    --input-json artifacts/release-artifact-guard.publish.json \
                    --output-json artifacts/audit-event-release-artifact-guard-publish.json \
                    --artifact-name release-artifact-guard-publish \
                    --retention-days 30

            - name: Publish artifact guard summary
              shell: bash
              run: |
                  set -euo pipefail
                  cat artifacts/release-artifact-guard.publish.md >> "$GITHUB_STEP_SUMMARY"

            - name: Publish release manifest summary
              shell: bash
              run: |
                  set -euo pipefail
                  cat artifacts/release-manifest.md >> "$GITHUB_STEP_SUMMARY"

            - name: Install cosign
              uses: sigstore/cosign-installer@faadad0cce49287aee09b3a48701e75088a2c6ad # v4.0.0

            - name: Sign artifacts with cosign (keyless)
              shell: bash
              run: |
                  set -euo pipefail
                  while IFS= read -r -d '' file; do
                    cosign sign-blob --yes \
                      --bundle="${file}.sigstore.json" \
                      --output-signature="${file}.sig" \
                      --output-certificate="${file}.pem" \
                      "$file"
                  done < <(find artifacts -type f ! -name '*.sig' ! -name '*.pem' ! -name '*.sigstore.json' -print0)

            - name: Compose release-notes supply-chain references
              shell: bash
              env:
                  RELEASE_TAG: ${{ needs.prepare.outputs.release_tag }}
              run: |
                  set -euo pipefail
                  python3 scripts/ci/release_notes_with_supply_chain_refs.py \
                    --artifacts-dir artifacts \
                    --repository "${GITHUB_REPOSITORY}" \
                    --release-tag "${RELEASE_TAG}" \
                    --output-json artifacts/release-notes-supply-chain.json \
                    --output-md artifacts/release-notes-supply-chain.md \
                    --fail-on-missing

            - name: Publish release-notes supply-chain summary
              shell: bash
              run: |
                  set -euo pipefail
                  cat artifacts/release-notes-supply-chain.md >> "$GITHUB_STEP_SUMMARY"

            - name: Verify GHCR release tag availability
              shell: bash
              env:
                  RELEASE_TAG: ${{ needs.prepare.outputs.release_tag }}
              run: |
                  set -euo pipefail
                  repo="${GITHUB_REPOSITORY,,}"
                  manifest_url="https://ghcr.io/v2/${repo}/manifests/${RELEASE_TAG}"
                  accept_header="application/vnd.oci.image.index.v1+json, application/vnd.docker.distribution.manifest.v2+json"
                  max_attempts=75
                  sleep_seconds=20

                  for attempt in $(seq 1 "$max_attempts"); do
                    token_resp="$(curl -sS "https://ghcr.io/token?scope=repository:${repo}:pull" || true)"
                    token="$(echo "$token_resp" | sed -n 's/.*"token":"\([^"]*\)".*/\1/p')"

                    if [ -z "$token" ]; then
                      code="000"
                    else
                      code="$(curl -sS -o /tmp/ghcr-release-manifest.json -w "%{http_code}" \
                        -H "Authorization: Bearer ${token}" \
                        -H "Accept: ${accept_header}" \
                        "${manifest_url}" || true)"
                    fi

                    if [ "$code" = "200" ]; then
                      echo "GHCR release tag is available: ${repo}:${RELEASE_TAG}"
                      exit 0
                  fi

                    if [ "$attempt" -lt "$max_attempts" ]; then
                      echo "Waiting for GHCR tag ${repo}:${RELEASE_TAG} (attempt ${attempt}/${max_attempts}, HTTP ${code})..."
                      sleep "$sleep_seconds"
                    fi
                  done

                  echo "::error::GHCR tag ${repo}:${RELEASE_TAG} was not available before release publish timeout."
                  cat /tmp/ghcr-release-manifest.json || true
                  exit 1

            - name: Create GitHub Release
              uses: softprops/action-gh-release@a06a81a03ee405af7f2048a818ed3f03bbf83c7b # v2
              with:
                  tag_name: ${{ needs.prepare.outputs.release_tag }}
                  draft: ${{ needs.prepare.outputs.draft_release == 'true' }}
                  body_path: artifacts/release-notes-supply-chain.md
                  generate_release_notes: true
                  files: |
                      artifacts/**/*
              env:
                  GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
